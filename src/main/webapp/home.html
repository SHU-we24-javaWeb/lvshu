<!DOCTYPE html>
<html lang="zh">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>小绿书--小旅SHU旅游交流平台</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:ital,wght@0,200;0,400;0,700;1,200&family=Unbounded:wght@400;700&display=swap" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="css/bootstrap.min.css" rel="stylesheet">
    <link href="css/bootstrap-icons.css" rel="stylesheet">
    <link href="css/tooplate-kool-form-pack.css" rel="stylesheet">
    <link href="css/home.css" rel="stylesheet">
</head>

<body>
<!-- 视频背景 -->
<div class="video-wrap">
    <video autoplay loop muted class="custom-video">
        <source src="videos/video.mp4" type="video/mp4">
    </video>
</div>

<!-- 菜单栏 -->
<div class="menu-buttons">
    <a href="home.html" class="menu-btn active">
        <i class="bi bi-house-door"></i> 首页
    </a>
    <a href="search.html" class="menu-btn">
        <i class="bi bi-search"></i> 搜索
    </a>
    <a href="create.html" class="menu-btn">
        <i class="bi bi-fire"></i> 创作
    </a>
    <a href="my.html" class="menu-btn">
        <i class="bi bi-person"></i> 我的
    </a>
</div>

<!-- 自动滚动展示栏 -->
<div id="customCarousel" class="carousel slide" data-bs-ride="carousel">
    <div class="carousel-inner" id="carouselInner">
        <!-- 动态内容将在这里添加 -->
    </div>
    <button class="carousel-control-prev" type="button" data-bs-target="#customCarousel" data-bs-slide="prev">
        <span class="carousel-control-prev-icon" aria-hidden="true"></span>
        <span class="visually-hidden">Previous</span>
    </button>
    <button class="carousel-control-next" type="button" data-bs-target="#customCarousel" data-bs-slide="next">
        <span class="carousel-control-next-icon" aria-hidden="true"></span>
        <span class="visually-hidden">Next</span>
    </button>
</div>

<!-- 内容部分 -->
<div class="content-section">
    <div class="container">
        <h2 class="section-title mb-4">推荐攻略</h2>
        <div class="horizontal-scroll">
            <div class="row g-4" id="myGuides">
                <!-- 动态内容将在这里添加 -->
            </div>
        </div>
    </div>
</div>

<!-- 页脚 -->
<footer>
    <div class="container">
        <p class="text-center mb-0">© 2025 小绿书--小旅SHU旅游交流平台 版权所有</p>
    </div>
</footer>

<!-- JavaScript 文件 -->
<script src="js/jquery.min.js"></script>
<script src="js/bootstrap.bundle.min.js"></script>
<script src="js/carousel.js"></script> <!-- 引入动态填充的JavaScript文件 -->
<script>

    document.addEventListener('DOMContentLoaded', function () {
        loadUserProfile();
    });

    function loadUserProfile() {
        fetch('/lvshu/hotGuideServlet')
            .then(response => response.json())
            .then(data => {
                console.log('API Response:', data);
                if (data.success) {

                    // 更新我的攻略列表
                    const myGuidesContainer = document.getElementById('myGuides');
                    myGuidesContainer.innerHTML = data.guides.map(guide => `
                            <div class="collection-card">
                                <img src="${guide.coverImage || 'images/default-cover.jpg'}"
                                     alt="${escapeHtml(guide.title)}"
                                     class="collection-image">
                                <div class="collection-content">
                                    <h3>${escapeHtml(guide.title)}</h3>
                                    <p>${escapeHtml(guide.content.substring(0, 100))}...</p>
                                    <div class="collection-meta">
                                        <span><i class="bi bi-eye"></i> ${guide.viewCount}</span>
                                        <span><i class="bi bi-heart"></i> ${guide.favoriteCount}</span>
                                        <div class="action-buttons">
                                            <a href="guide-detail.html?id=${guide.guideId}"
                                               class="edit-btn">
                                                查看详情
                                            </a>

                                        </div>
                                    </div>
                                </div>
                            </div>
                        `).join('');


                } else {
                    alert('加载用户信息失败：' + (data.message || '未知错误'));
                }
            })
            .catch(error => {
                console.error('Error:', error);
                alert('加载用户信息失败，请稍后重试');
            });
    }
    // 辅助函数：HTML转义
    function escapeHtml(unsafe) {
        return unsafe
            .replace(/&/g, "&amp;")
            .replace(/</g, "&lt;")
            .replace(/>/g, "&gt;")
            .replace(/"/g, "&quot;")
            .replace(/'/g, "&#039;");
    }
</script>
</body>

</html>